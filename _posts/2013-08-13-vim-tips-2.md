---
layout: post
title: "vim tips 2"
description: ""
category: config
tags: vim rxvt linux python
---
{% include JB/setup %}

### vim mouse urxvt

Vim version 7.4 added urxvt mouse feature.
Here is the method to enable it.

{% highlight vim %}
set ttymouse=urxvt    " terminal type
set mousemodle=extend " right mouse button extends a selection
set mouse=a           " enable mouse in all modes
{% endhighlight %}

However there is some problem with tmux.So it's actually of no use to me.

### about unite.vim

1. Basic structure of a unite source

{% highlight vim %}
let s:source = {} " options

function! s:source.gather_candidates(args, context) " return a list/dict of candidates
...
endfunction

function! s:source.hooks.on_init(args, context) " function called on init if needed
...
endfunction

function! s:source.hooks.on_close(args, context) " function called on close if needed
...
endfunction

let s:source.action_table.action_name= { " define an action
      \ 'description' : 'description string',
      \ 'is_quit' : 0,
      \ }
function! s:source.action_table.action_name.func(candidate) " function called with the action
...
endfunction

" other actions
{% endhighlight %}

2. First try

I added an edit action to source/function.vim in order to jump through vimscript functions fast.

{% highlight vim linenos %}
let s:source.action_table.edit = {
      \ 'description' : 'edit the function from the source',
      \ }
function! s:source.action_table.edit.func(candidates)
    let s:register_old = @f
    redir @f
    silent execute 'verbose function '.a:candidates.action__function
    redir end
    let s:filepath = matchstr(split(@f,'\n')[1], 'Last set from \zs.*$')
    execute 'e '.s:filepath
    execute search('\v^[ \t]*fu(nction)=[ !]*'.a:candidates.action__function)
    let @f = s:register_old
endfunction
{% endhighlight %}

### vim colorpicker improvement

I think it necessary when editing css files.
I found a vim script with +python online.It works well with Gvim.However it has some problems with
vim under term(at least urxvt) -- The gtk interface won't close after pressing 'OK'
I am not familiar with vim lib of python,and I haven't figured out how to fix this using the same structure.

So I have to separated the python part off the vim script and make it returns the hex code of the color picked.
Here is the remained vimscript part.It replace the first occurrence of color code in format of both hex or rgb after the cursor in current line with the output in current line with the output.

{% highlight vim linenos %}
command! ColorPicker :call ReadColor()

function! ReadColor()
    if !exists("g:colorpicker_path")
        let g:colorpicker_path = $HOME."/.vim/bundle/vim-colorpicker/colorpicker.py"
    endif
    let s:color = substitute(system(g:colorpicker_path),'\n','','g')
    let s:oldcolor = matchstr(getline(line('.')),'\(#[0-9A-Fa-f]\{6}\|#[0-9A-Fa-f]\{3}\|rgb([ .0-9,]\{5,})\)',col('.')-1)
    if s:oldcolor != ""
        execute "s/".s:oldcolor."/".s:color."/"
    else
        execute "normal! i\<C-R>=s:color\<ESC>"
    endif

endfunction
{% endhighlight %}

**Future work**
1. Add rgb format returning.It's really easy to accomplish but it is just of no meaning to me because I've met no situation which allows rgb format only.
2. Add rgba format returning.It is useful when alpha value is needed.However in order to add that feature,I have to totally rewrite the python part.And the code will be much longer.
3. Windows/osx support.The script only works with linux system because the python part needs pygtk to run.It's convenient to use gtk.ColorSelectionDialog to generate
the basic interface.So something similar to that in windows/osx will be of great help.
